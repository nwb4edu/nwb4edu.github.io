
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Analyzing Two Photon Data &#8212; Teaching &amp; Learning with NWB Datasets</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Correlations in Two Photon Data" href="Correlations_in_Two_Photon_Data.html" />
    <link rel="prev" title="Retrieving Calcium Imaging Data" href="Retrieving_Brain_Observatory_Data.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      <img src="../_static/nwb_learning.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Teaching & Learning with NWB Datasets</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../landing_page.html">
   Teaching and Learning with NWB Datasets
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Introduction
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chapter_01/Introduction.html">
   Introduction
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter_01/Using_This_Book.html">
     How to Use this Book
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter_01/Setup.html">
     Setup
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter_01/For_Educators.html">
     For Educators
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chapter_02/Data_Science_In_Python.html">
   Data Science in Python
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter_02/NumPy.html">
     NumPy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter_02/Pandas.html">
     Pandas
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter_02/SciPy.html">
     SciPy
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  pynwb
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chapter_03/NWB_Dataset_Structure.html">
   Lesson #1: The Structure of NWB Datasets
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter_03/Obtaining_Datasets_with_DANDI.html">
     Obtaining Datasets with DANDI
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter_03/Working_with_NWB_format_in_Python.html">
     Working with NWB in Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter_03/Interactive_NWB_Data_Exploration.html">
     Interactive NWB Data Exploration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter_03/Chapter_3_ProblemSet.html">
     Lesson #1 Problem Set
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chapter_04/Large_Scale_Electrophysiology.html">
   Lesson #2: Analyzing Extracellular Recordings
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter_04/SpikeSorting.html">
     Spike Sorting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter_04/Visualizing_Recordings.html">
     Visualizing Large Scale Recordings
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter_04/Chapter_4_ProblemSet.html">
     Lesson #2 Problem Set
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  allensdk
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chapter_06/Single-Cell_Electrophysiology.html">
   Lesson #3: Single-Cell Electrophysiology
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter_06/Obtaining_Data_For_Single_Cells.html">
     Obtaining Data for Single Cells
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter_06/Analyzing_Computed_Features.html">
     Analyzing Computed Features
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter_06/Lesson3_ProblemSet.html">
     Lesson 3 Problem Set
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="Two_Photon_Imaging.html">
   Lesson #4: Two Photon Imaging
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="Retrieving_Brain_Observatory_Data.html">
     Retrieving Calcium Imaging Data
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Analyzing Two Photon Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="Correlations_in_Two_Photon_Data.html">
     Correlations in Two Photon Data
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/Chapter_07/Analyzing_Two_Photon_Data.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/nwb4edu/nwb4edu.github.io/master?urlpath=tree/Chapter_07/Analyzing_Two_Photon_Data.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/nwb4edu/nwb4edu.github.io/blob/master/Chapter_07/Analyzing_Two_Photon_Data.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        <button type="button" class="btn btn-secondary topbarbtn"
            onclick="initThebeSBT()" title="Launch Thebe" data-toggle="tooltip" data-placement="left"><i
                class="fas fa-play"></i><span style="margin-left: .4em;">Live Code</span></button>
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup">
   Setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#download-inspect-the-natural-scenes-imaging-session">
   Download &amp; inspect the natural scenes imaging session
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#converting-calcium-imaging-into-spikes">
   Converting Calcium Imaging into Spikes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#look-at-the-response-of-your-cells-to-natural-scenes">
   Look at the response of your cells to natural scenes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#examine-the-direction-selectivity-of-your-cell">
   Examine the direction selectivity of your cell
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="analyzing-two-photon-data">
<h1>Analyzing Two Photon Data<a class="headerlink" href="#analyzing-two-photon-data" title="Permalink to this headline">¶</a></h1>
<p>On the previous page, we introduced how to retrieve specific experiments from the Allen Institute SDK’s Brain Observatory. Here we’ll introduce how researchers analyze this data, from processing single cell activity to understanding tuning curves.</p>
<div class="section" id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<p>We need a variety of standard Python packages in addition to two different <code class="docutils literal notranslate"><span class="pre">allensdk</span></code> toolboxes. If you have not yet installed the <code class="docutils literal notranslate"><span class="pre">allensdk</span></code>, run the cell below. Otherwise, you can skip to the cell that imports our toolboxes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This will ensure that the AllenSDK is installed.</span>
<span class="c1"># If not, it will install it for you.</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">allensdk</span>
    <span class="k">if</span> <span class="n">allensdk</span><span class="o">.</span><span class="n">__version__</span> <span class="o">==</span> <span class="s1">&#39;2.11.2&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;allensdk already installed.&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;incompatible version of allensdk installed&#39;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="o">!</span>pip install allensdk
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>allensdk already installed.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import toolboxes</span>
<span class="kn">from</span> <span class="nn">allensdk.core.brain_observatory_cache</span> <span class="kn">import</span> <span class="n">BrainObservatoryCache</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span> 
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> 
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Packages imported.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/ashley/anaconda3/lib/python3.7/site-packages/dask/config.py:168: YAMLLoadWarning: calling yaml.load() without Loader=... is deprecated, as the default Loader is unsafe. Please read https://msg.pyyaml.org/load for full details.
  data = yaml.load(f.read()) or {}
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Packages imported.
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="download-inspect-the-natural-scenes-imaging-session">
<h2>Download &amp; inspect the natural scenes imaging session<a class="headerlink" href="#download-inspect-the-natural-scenes-imaging-session" title="Permalink to this headline">¶</a></h2>
<p>First, we’ll look at an experiment where the mouse viewed natural scenes. Below, we’ll assign an experiment container ID (the same one we worked with in the previous section), designate that we’re interested in only the natural scenes experiments, and download the data for the first experiment in the container.</p>
<p><strong>Note</strong>: The cell below downloads some data, and make take a minute or so to run. It is important that you do not interrupt the download of the data or else the file will become corrupted and you will have to delete it and try again.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an instance of the Brain Observatory cache</span>
<span class="n">boc</span> <span class="o">=</span> <span class="n">BrainObservatoryCache</span><span class="p">(</span><span class="n">manifest_file</span><span class="o">=</span><span class="s1">&#39;manifest.json&#39;</span><span class="p">)</span>

<span class="c1"># Assign container ID from previous section</span>
<span class="n">exp_container_id</span> <span class="o">=</span> <span class="mi">627823571</span>
<span class="n">stim</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;natural_scenes&#39;</span><span class="p">]</span>

<span class="c1"># Get experiments for our container id and stimuli of interest</span>
<span class="n">experiments</span> <span class="o">=</span> <span class="n">boc</span><span class="o">.</span><span class="n">get_ophys_experiments</span><span class="p">(</span><span class="n">experiment_container_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">exp_container_id</span><span class="p">],</span>
                                     <span class="n">stimuli</span> <span class="o">=</span> <span class="n">stim</span><span class="p">)</span>

<span class="c1"># Assign the experiment id </span>
<span class="n">experiment_id</span> <span class="o">=</span> <span class="n">experiments</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
<span class="n">experiment_data</span> <span class="o">=</span> <span class="n">boc</span><span class="o">.</span><span class="n">get_ophys_experiment_data</span><span class="p">(</span><span class="n">experiment_id</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Data acquired.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="mi">721</span><span class="n">ebef5e10c</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="c1"># Get experiments for our container id and stimuli of interest</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="n">experiments</span> <span class="o">=</span> <span class="n">boc</span><span class="o">.</span><span class="n">get_ophys_experiments</span><span class="p">(</span><span class="n">experiment_container_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">exp_container_id</span><span class="p">],</span>
<span class="ne">---&gt; </span><span class="mi">10</span>                                      <span class="n">stimuli</span> <span class="o">=</span> <span class="n">stim</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> 
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="c1"># Assign the experiment id</span>

<span class="nn">~/anaconda3/lib/python3.7/site-packages/allensdk/core/brain_observatory_cache.py</span> in <span class="ni">get_ophys_experiments</span><span class="nt">(self, file_name, ids, experiment_container_ids, targeted_structures, imaging_depths, cre_lines, reporter_lines, transgenic_lines, stimuli, session_types, cell_specimen_ids, include_failed, require_eye_tracking, simple)</span>
<span class="g g-Whitespace">    </span><span class="mi">326</span>         <span class="n">exps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">get_ophys_experiments</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">327</span>                                               <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;lazy&#39;</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">328</span>                                               <span class="o">**</span><span class="n">Cache</span><span class="o">.</span><span class="n">cache_json</span><span class="p">())</span>
<span class="g g-Whitespace">    </span><span class="mi">329</span> 
<span class="g g-Whitespace">    </span><span class="mi">330</span>         <span class="c1"># NOTE: Ugly hack to update the &#39;fail_eye_tracking&#39; field</span>

<span class="nn">~/anaconda3/lib/python3.7/site-packages/allensdk/api/warehouse_cache/cache.py</span> in <span class="ni">w</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">661</span>             <span class="n">result</span> <span class="o">=</span> <span class="n">Cache</span><span class="o">.</span><span class="n">cacher</span><span class="p">(</span><span class="n">func</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">662</span>                                   <span class="o">*</span><span class="n">args</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">663</span>                                   <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">664</span>             <span class="k">return</span> <span class="n">result</span>
<span class="g g-Whitespace">    </span><span class="mi">665</span> 

<span class="nn">~/anaconda3/lib/python3.7/site-packages/allensdk/api/warehouse_cache/cache.py</span> in <span class="ni">cacher</span><span class="nt">(fn, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">381</span> 
<span class="g g-Whitespace">    </span><span class="mi">382</span>             <span class="k">if</span> <span class="n">writer</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">383</span>                 <span class="n">data</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">384</span>                 <span class="n">data</span> <span class="o">=</span> <span class="n">pre</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">385</span>                 <span class="n">writer</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

<span class="nn">~/anaconda3/lib/python3.7/site-packages/allensdk/api/queries/brain_observatory_api.py</span> in <span class="ni">get_ophys_experiments</span><span class="nt">(self, ophys_experiment_ids)</span>
<span class="g g-Whitespace">    </span><span class="mi">215</span>         <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_query</span><span class="p">(</span><span class="s1">&#39;brain_observatory_queries&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">216</span>                                    <span class="s1">&#39;ophys_experiment_by_ids&#39;</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">217</span>                                    <span class="n">ophys_experiment_ids</span><span class="o">=</span><span class="n">ophys_experiment_ids</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">218</span> 
<span class="g g-Whitespace">    </span><span class="mi">219</span>         <span class="k">return</span> <span class="n">data</span>

<span class="nn">~/anaconda3/lib/python3.7/site-packages/allensdk/api/queries/rma_template.py</span> in <span class="ni">template_query</span><span class="nt">(self, template_name, entry_name, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">130</span>         <span class="n">query_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">131</span> 
<span class="ne">--&gt; </span><span class="mi">132</span>         <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_query</span><span class="p">(</span><span class="o">**</span><span class="n">query_args</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">133</span> 
<span class="g g-Whitespace">    </span><span class="mi">134</span>         <span class="k">return</span> <span class="n">data</span>

<span class="nn">~/anaconda3/lib/python3.7/site-packages/allensdk/api/queries/rma_api.py</span> in <span class="ni">model_query</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">257</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_msg_query</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">258</span>             <span class="bp">self</span><span class="o">.</span><span class="n">build_query_url</span><span class="p">(</span>
<span class="ne">--&gt; </span><span class="mi">259</span>                 <span class="bp">self</span><span class="o">.</span><span class="n">model_stage</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)))</span>
<span class="g g-Whitespace">    </span><span class="mi">260</span> 
<span class="g g-Whitespace">    </span><span class="mi">261</span>     <span class="k">def</span> <span class="nf">service_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

<span class="nn">~/anaconda3/lib/python3.7/site-packages/allensdk/api/api.py</span> in <span class="ni">json_msg_query</span><span class="nt">(self, url, dataframe)</span>
<span class="g g-Whitespace">    </span><span class="mi">163</span> 
<span class="g g-Whitespace">    </span><span class="mi">164</span>         <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_query</span><span class="p">(</span><span class="k">lambda</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">165</span>                              <span class="bp">self</span><span class="o">.</span><span class="n">read_data</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">166</span> 
<span class="g g-Whitespace">    </span><span class="mi">167</span>         <span class="k">if</span> <span class="n">dataframe</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>

<span class="nn">~/anaconda3/lib/python3.7/site-packages/allensdk/api/api.py</span> in <span class="ni">do_query</span><span class="nt">(self, url_builder_fn, json_traversal_fn, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">202</span>         <span class="n">post</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;post&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">203</span> 
<span class="ne">--&gt; </span><span class="mi">204</span>         <span class="n">json_parsed_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retrieve_parsed_json_over_http</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">205</span> 
<span class="g g-Whitespace">    </span><span class="mi">206</span>         <span class="k">return</span> <span class="n">json_traversal_fn</span><span class="p">(</span><span class="n">json_parsed_data</span><span class="p">)</span>

<span class="nn">~/anaconda3/lib/python3.7/site-packages/allensdk/api/api.py</span> in <span class="ni">retrieve_parsed_json_over_http</span><span class="nt">(self, url, post)</span>
<span class="g g-Whitespace">    </span><span class="mi">369</span>             <span class="n">data</span> <span class="o">=</span> <span class="n">json_utilities</span><span class="o">.</span><span class="n">read_url_get</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">370</span>                 <span class="n">requests</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">url</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">371</span>                                      <span class="s1">&#39;;/?:@&amp;=+$,&#39;</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">372</span>         <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">373</span>             <span class="n">data</span> <span class="o">=</span> <span class="n">json_utilities</span><span class="o">.</span><span class="n">read_url_post</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="nn">~/anaconda3/lib/python3.7/site-packages/allensdk/core/json_utilities.py</span> in <span class="ni">read_url_get</span><span class="nt">(url)</span>
<span class="g g-Whitespace">    </span><span class="mi">108</span>     <span class="s1">&#39;&#39;&#39;</span>
<span class="g g-Whitespace">    </span><span class="mi">109</span><span class="s1">     response = urllib_request.urlopen(url)</span>
<span class="ne">--&gt; </span><span class="mi">110</span><span class="s1">     json_string = response.read().decode(&#39;utf-8&#39;)</span>
<span class="g g-Whitespace">    </span><span class="mi">111</span><span class="s1"> </span>
<span class="g g-Whitespace">    </span><span class="mi">112</span><span class="s1">     return json.loads(json_string)</span>

<span class="nn">~/anaconda3/lib/python3.7/http/client.py</span> in <span class="ni">read</span><span class="nt">(self, amt)</span>
<span class="g g-Whitespace">    </span><span class="mi">452</span><span class="s1"> </span>
<span class="g g-Whitespace">    </span><span class="mi">453</span><span class="s1">             if self.chunked:</span>
<span class="ne">--&gt; </span><span class="mi">454</span><span class="s1">                 return self._readall_chunked()</span>
<span class="g g-Whitespace">    </span><span class="mi">455</span><span class="s1"> </span>
<span class="g g-Whitespace">    </span><span class="mi">456</span><span class="s1">             if self.length is None:</span>

<span class="nn">~/anaconda3/lib/python3.7/http/client.py</span> in <span class="ni">_readall_chunked</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">562</span><span class="s1">                 if chunk_left is None:</span>
<span class="g g-Whitespace">    </span><span class="mi">563</span><span class="s1">                     break</span>
<span class="ne">--&gt; </span><span class="mi">564</span><span class="s1">                 value.append(self._safe_read(chunk_left))</span>
<span class="g g-Whitespace">    </span><span class="mi">565</span><span class="s1">                 self.chunk_left = 0</span>
<span class="g g-Whitespace">    </span><span class="mi">566</span><span class="s1">             return b&#39;&#39;.join(value)</span>

<span class="nn">~/anaconda3/lib/python3.7/http/client.py</span> in <span class="ni">_safe_read</span><span class="nt">(self, amt)</span>
<span class="g g-Whitespace">    </span><span class="mi">608</span><span class="s1">         s = []</span>
<span class="g g-Whitespace">    </span><span class="mi">609</span><span class="s1">         while amt &gt; 0:</span>
<span class="ne">--&gt; </span><span class="mi">610</span><span class="s1">             chunk = self.fp.read(min(amt, MAXAMOUNT))</span>
<span class="g g-Whitespace">    </span><span class="mi">611</span><span class="s1">             if not chunk:</span>
<span class="g g-Whitespace">    </span><span class="mi">612</span><span class="s1">                 raise IncompleteRead(b&#39;&#39;.join(s), amt)</span>

<span class="nn">~/anaconda3/lib/python3.7/socket.py</span> in <span class="ni">readinto</span><span class="nt">(self, b)</span>
<span class="g g-Whitespace">    </span><span class="mi">587</span><span class="s1">         while True:</span>
<span class="g g-Whitespace">    </span><span class="mi">588</span><span class="s1">             try:</span>
<span class="ne">--&gt; </span><span class="mi">589</span><span class="s1">                 return self._sock.recv_into(b)</span>
<span class="g g-Whitespace">    </span><span class="mi">590</span><span class="s1">             except timeout:</span>
<span class="g g-Whitespace">    </span><span class="mi">591</span><span class="s1">                 self._timeout_occurred = True</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<p>Let’s take a quick look at the data you just downloaded. We’ll create a <strong>maximum projection image</strong> of the data, so that we can see the cells in our field of view. If we just looked at one snapshot of the raw imaging data, the cells would look dim – they only become bright when they’re actively firing. A maximum projection image shows us the maximum brightness for each pixel, across the entire experiment. Please visit the <a href = 'https://alleninstitute.github.io/AllenSDK/allensdk.core.brain_observatory_nwb_data_set.html'> Brain Observatory NWB Data Set documentation </a> for the original documentation to the methods used in the fluorescence imaging and natural scenes section.</p>
<p>Below, we are using the <code class="docutils literal notranslate"><span class="pre">get_max_projection()</span></code> method on our data, and then using the <code class="docutils literal notranslate"><span class="pre">imshow()</span></code> method in order to see our projection.</p>
<p><strong>Note</strong>: The weird text for the ylabel is called “TeX” markup, in order to get the greek symbol <em>mu</em> (<span class="math notranslate nohighlight">\(\mu\)</span>). See documentation on the <a href="https://matplotlib.org/tutorials/text/mathtext.html">matplotlib website</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the maximum projection (a numpy array) of our data</span>
<span class="n">max_projection</span> <span class="o">=</span> <span class="n">experiment_data</span><span class="o">.</span><span class="n">get_max_projection</span><span class="p">()</span>

<span class="c1"># Create a new figure</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="c1"># Use imshow to visualize our numpy array</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">max_projection</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>

<span class="c1"># Add labels for microns; weird syntax below is to get the micro sign</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\mu$m&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\mu$m&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Analyzing_Two_Photon_Data_6_0.png" src="../_images/Analyzing_Two_Photon_Data_6_0.png" />
</div>
</div>
</div>
<div class="section" id="converting-calcium-imaging-into-spikes">
<h2>Converting Calcium Imaging into Spikes<a class="headerlink" href="#converting-calcium-imaging-into-spikes" title="Permalink to this headline">¶</a></h2>
<p>Now we’ll plot the data of each of our cells (from the field of view above) across time. Each line shows the change in fluorescence over baseline (<span class="math notranslate nohighlight">\(\Delta\)</span>)F/F) of the individual cells. When there are sharp increases, that’s when the cells are responding.</p>
<p>In the example below, we will plot the first 10 cells from our data. the <code class="docutils literal notranslate"><span class="pre">get_dff_traces()</span></code> method returns the timestamps (in seconds) and deltaF/F.</p>
<p>Below, we’ve also added a line in our loop that offsets each cell by a predetermined amount so that we can see individual calcium traces. Each line is a different neuron, and the small blips in the data are calcium-mediated changes in fluorescence.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Assign timestamps and deltaF/F</span>
<span class="n">ts</span><span class="p">,</span> <span class="n">dff</span> <span class="o">=</span> <span class="n">experiment_data</span><span class="o">.</span><span class="n">get_dff_traces</span><span class="p">()</span>

<span class="c1"># Set up a figure</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="c1"># Loop through to add an offset on the y-axis</span>
<span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">dff</span><span class="p">[</span><span class="n">cell</span><span class="p">]</span><span class="o">+</span><span class="n">offset</span><span class="p">)</span>
    <span class="n">offset</span><span class="o">+=</span><span class="mi">5</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Timestamp (s)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Neurons ($\Delta$F\F)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">2700</span><span class="p">,</span><span class="mi">2720</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Analyzing_Two_Photon_Data_9_0.png" src="../_images/Analyzing_Two_Photon_Data_9_0.png" />
</div>
</div>
</div>
<div class="section" id="look-at-the-response-of-your-cells-to-natural-scenes">
<h2>Look at the response of your cells to natural scenes<a class="headerlink" href="#look-at-the-response-of-your-cells-to-natural-scenes" title="Permalink to this headline">¶</a></h2>
<p>There are clearly some responses above, but it’s tough to see whether this corresponds to different behaviors or visual stimuli with just the raw fluorescence traces.</p>
<p>Let’s see how these cells actually responded to different types of images. To do so, we’ll need to use the <code class="docutils literal notranslate"><span class="pre">get_cell_specimens()</span></code> method on our <code class="docutils literal notranslate"><span class="pre">boc</span></code>, giving it the name of the experiment container ID.</p>
<p>The dataframe that this creates will have a lot more information about what the cells in our experiment prefer. Each row is a different cell, each with its own preferences and response patterns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the cell specimens information for this experiment</span>
<span class="n">cell_specimens</span> <span class="o">=</span> <span class="n">boc</span><span class="o">.</span><span class="n">get_cell_specimens</span><span class="p">(</span><span class="n">experiment_container_ids</span><span class="o">=</span><span class="p">[</span><span class="n">exp_container_id</span><span class="p">])</span>
<span class="n">cell_specimens_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cell_specimens</span><span class="p">)</span>
<span class="n">cell_specimens_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>all_stim</th>
      <th>area</th>
      <th>cell_specimen_id</th>
      <th>donor_full_genotype</th>
      <th>dsi_dg</th>
      <th>experiment_container_id</th>
      <th>failed_experiment_container</th>
      <th>g_dsi_dg</th>
      <th>g_osi_dg</th>
      <th>g_osi_sg</th>
      <th>...</th>
      <th>specimen_id</th>
      <th>tfdi_dg</th>
      <th>time_to_peak_ns</th>
      <th>time_to_peak_sg</th>
      <th>tld1_id</th>
      <th>tld1_name</th>
      <th>tld2_id</th>
      <th>tld2_name</th>
      <th>tlr1_id</th>
      <th>tlr1_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>False</td>
      <td>VISp</td>
      <td>662199586</td>
      <td>Tlx3-Cre_PL56/wt;Ai148(TIT2L-GC6f-ICL-tTA2)/wt</td>
      <td>NaN</td>
      <td>627823571</td>
      <td>False</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>603751387</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>265180449</td>
      <td>Tlx3-Cre_PL56</td>
      <td>None</td>
      <td>None</td>
      <td>528393470</td>
      <td>Ai148(TIT2L-GC6f-ICL-tTA2)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>False</td>
      <td>VISp</td>
      <td>662199605</td>
      <td>Tlx3-Cre_PL56/wt;Ai148(TIT2L-GC6f-ICL-tTA2)/wt</td>
      <td>0.793449</td>
      <td>627823571</td>
      <td>False</td>
      <td>0.452460</td>
      <td>0.360264</td>
      <td>0.640623</td>
      <td>...</td>
      <td>603751387</td>
      <td>0.265616</td>
      <td>0.29916</td>
      <td>0.29916</td>
      <td>265180449</td>
      <td>Tlx3-Cre_PL56</td>
      <td>None</td>
      <td>None</td>
      <td>528393470</td>
      <td>Ai148(TIT2L-GC6f-ICL-tTA2)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>True</td>
      <td>VISp</td>
      <td>662199626</td>
      <td>Tlx3-Cre_PL56/wt;Ai148(TIT2L-GC6f-ICL-tTA2)/wt</td>
      <td>0.346550</td>
      <td>627823571</td>
      <td>False</td>
      <td>0.346134</td>
      <td>0.107403</td>
      <td>0.943987</td>
      <td>...</td>
      <td>603751387</td>
      <td>0.393678</td>
      <td>0.29916</td>
      <td>0.33240</td>
      <td>265180449</td>
      <td>Tlx3-Cre_PL56</td>
      <td>None</td>
      <td>None</td>
      <td>528393470</td>
      <td>Ai148(TIT2L-GC6f-ICL-tTA2)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>False</td>
      <td>VISp</td>
      <td>662199645</td>
      <td>Tlx3-Cre_PL56/wt;Ai148(TIT2L-GC6f-ICL-tTA2)/wt</td>
      <td>0.636332</td>
      <td>627823571</td>
      <td>False</td>
      <td>0.629502</td>
      <td>0.971795</td>
      <td>NaN</td>
      <td>...</td>
      <td>603751387</td>
      <td>0.357068</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>265180449</td>
      <td>Tlx3-Cre_PL56</td>
      <td>None</td>
      <td>None</td>
      <td>528393470</td>
      <td>Ai148(TIT2L-GC6f-ICL-tTA2)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>False</td>
      <td>VISp</td>
      <td>662199683</td>
      <td>Tlx3-Cre_PL56/wt;Ai148(TIT2L-GC6f-ICL-tTA2)/wt</td>
      <td>NaN</td>
      <td>627823571</td>
      <td>False</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.524082</td>
      <td>...</td>
      <td>603751387</td>
      <td>NaN</td>
      <td>0.29916</td>
      <td>0.33240</td>
      <td>265180449</td>
      <td>Tlx3-Cre_PL56</td>
      <td>None</td>
      <td>None</td>
      <td>528393470</td>
      <td>Ai148(TIT2L-GC6f-ICL-tTA2)</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 60 columns</p>
</div></div></div>
</div>
<p>Let’s create a bar graph of preferred images in our dataset. The <code class="docutils literal notranslate"><span class="pre">p_ns</span></code> column contains the pvalue that corresponds to whether a cell <em>significantly</em> prefered an image more than the rest. We will use this column to subset our <code class="docutils literal notranslate"><span class="pre">cell_specimens_df</span></code> dataframe to only contains cells that have a p value less than 0.05.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">pref_image_ns</span></code> column contains the image IDs of the stimulus being presented. We can create our bar graph from this column to see how many cells responded to these statistically significant images.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Subset dataframe to contain significantly preferred images </span>
<span class="n">col_1</span> <span class="o">=</span> <span class="s1">&#39;p_ns&#39;</span>
<span class="n">sig_cells</span> <span class="o">=</span> <span class="n">cell_specimens_df</span><span class="p">[</span><span class="n">cell_specimens_df</span><span class="p">[</span><span class="n">col_1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">]</span>

<span class="c1"># Assign our image ids for significantly preferred images</span>
<span class="n">col_2</span> <span class="o">=</span> <span class="s1">&#39;pref_image_ns&#39;</span>
<span class="n">pref_images</span> <span class="o">=</span> <span class="n">sig_cells</span><span class="p">[</span><span class="n">col_2</span><span class="p">]</span>

<span class="c1"># Set up our figure </span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="c1"># Plot our bar graph</span>
<span class="n">pref_counts</span> <span class="o">=</span> <span class="n">pref_images</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">pref_counts</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Response of cells to natural scenes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Number of cells&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Image ID&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Analyzing_Two_Photon_Data_13_0.png" src="../_images/Analyzing_Two_Photon_Data_13_0.png" />
</div>
</div>
<p>In order to actually see what these images are, first, we’ll organize the stimulus table. This tells us which stimulus was played on each trial. This data set has 118 different scenes, and each scene is presented 50 times. Images of the scenes can be found <a class="reference external" href="http://observatory.brain-map.org/visualcoding/stimulus/natural_scenes">here</a>.</p>
<p>Below, we’ll show the top five images for cells in this field of view. Do they have anything in common, either visually or conceptually?</p>
<p><em>Note</em>: Not every experiment contains the data for the natural scenes experiment. If you change the experiment ID above and try the next cell, you may receive an error. You can use <code class="docutils literal notranslate"><span class="pre">data.list_stimuli()</span></code> to see all of the stimuli available within your experiment.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the natural scene information</span>
<span class="n">natural_scene_table</span> <span class="o">=</span> <span class="n">experiment_data</span><span class="o">.</span><span class="n">get_stimulus_table</span><span class="p">(</span><span class="s1">&#39;natural_scenes&#39;</span><span class="p">)</span>
<span class="n">natural_scene_template</span> <span class="o">=</span> <span class="n">experiment_data</span><span class="o">.</span><span class="n">get_stimulus_template</span><span class="p">(</span><span class="s1">&#39;natural_scenes&#39;</span><span class="p">)</span>
<span class="n">sceneIDs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">natural_scene_table</span><span class="o">.</span><span class="n">frame</span><span class="p">)</span>

<span class="c1"># Set up our figure</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="k">for</span> <span class="n">image_ID</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span> <span class="c1"># Show the first 5 images</span>
    
    <span class="n">image_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pref_counts</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">image_ID</span><span class="p">])</span> <span class="c1"># Get the image ID</span>

    <span class="c1"># Use imshow to visualize our numpy array</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">image_ID</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">natural_scene_template</span><span class="p">[</span><span class="n">image_id</span><span class="p">,:,:],</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">image_ID</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">image_ID</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">image_ID</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Image &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">image_id</span><span class="p">))</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Analyzing_Two_Photon_Data_15_0.png" src="../_images/Analyzing_Two_Photon_Data_15_0.png" />
</div>
</div>
</div>
<div class="section" id="examine-the-direction-selectivity-of-your-cell">
<h2>Examine the direction selectivity of your cell<a class="headerlink" href="#examine-the-direction-selectivity-of-your-cell" title="Permalink to this headline">¶</a></h2>
<p>Sometimes, the function of a cell is not particularly clear from natural stimuli. Those stimuli have a lot of information in them, and it might be hard to tell what a cell is actually responding to. Instead, we can use simple drifting gratings to look at one straightforward property of a cell: <b>does it respond to specific directions of movement?</b></br> To do so, we’ll examine the <strong>drifting gratings</strong> experiments.</p>
<p>We will now show how to plot a heatmap of a cell’s response organized by orientation and temporal frequency. We will be using one of the three cells from the dataframe above which showed direction selectivity from the significantly preferred images. Please visit the <a href = 'https://allensdk.readthedocs.io/en/latest/allensdk.brain_observatory.drifting_gratings.html'> Drifting Gratings module documentation </a> for additional help on the methods used in the drifting gratings section.</p>
<p>Below, we’ll use the same experiment container but a different stimulus to create a separate experiment dataset, <code class="docutils literal notranslate"><span class="pre">dg_experiment</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get experiment for our container id and stimuli of interest</span>
<span class="n">stim_2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;drifting_gratings&#39;</span><span class="p">]</span>
<span class="n">dg_experiment</span> <span class="o">=</span> <span class="n">boc</span><span class="o">.</span><span class="n">get_ophys_experiments</span><span class="p">(</span>
                        <span class="n">experiment_container_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">exp_container_id</span><span class="p">],</span>
                        <span class="n">stimuli</span> <span class="o">=</span> <span class="n">stim_2</span><span class="p">)</span>

<span class="c1"># Download the experiment data using the experiment id</span>
<span class="n">experiment_id_2</span> <span class="o">=</span> <span class="n">dg_experiment</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
<span class="n">data_dg</span> <span class="o">=</span> <span class="n">boc</span><span class="o">.</span><span class="n">get_ophys_experiment_data</span><span class="p">(</span><span class="n">experiment_id_2</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Data acquired.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Data acquired.
</pre></div>
</div>
</div>
</div>
<p>Our first step is to create an instance of our DriftingGratings object. The DriftingGratings class requires an NWB data set as an input (i.e. <code class="docutils literal notranslate"><span class="pre">data_dg</span></code>).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">peak</span></code> property of the DriftingGratings object returns a Pandas DataFrame of peak conditions (direction and temporal frequency) as well as computed response metrics. Some key columns is this dataframe are the preferred orientation, <code class="docutils literal notranslate"><span class="pre">ori_dg</span></code>, and preferred frequency, <code class="docutils literal notranslate"><span class="pre">tf_dg</span></code>, of the cell. Other computed metrics include:</p>
<ul class="simple">
<li><p>reliability_dg</p></li>
<li><p>osi_dg (orientation selectivity index)</p></li>
<li><p>dsi_dg (direction selectivity index)</p></li>
<li><p>peak_dff_dg (peak dF/F)</p></li>
<li><p>ptest_dg (number of signficant cells)</p></li>
<li><p>p_run_dg (K-S statistic comparing running trials to stationary trials)</p></li>
<li><p>run_modulation_dg</p></li>
<li><p>cv_dg (circular variance)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">allensdk.brain_observatory.drifting_gratings</span> <span class="kn">import</span> <span class="n">DriftingGratings</span>

<span class="c1"># Create my DriftingGratings Object </span>
<span class="n">dg</span> <span class="o">=</span> <span class="n">DriftingGratings</span><span class="p">(</span><span class="n">data_dg</span><span class="p">)</span>

<span class="c1"># Return dataframe of peak conditions</span>
<span class="n">dg_df</span> <span class="o">=</span> <span class="n">dg</span><span class="o">.</span><span class="n">peak</span>
<span class="n">dg_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/VictorMagdaleno/opt/anaconda3/lib/python3.7/site-packages/pandas/core/indexing.py:205: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  self._setitem_with_indexer(indexer, value)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ori_dg</th>
      <th>tf_dg</th>
      <th>reliability_dg</th>
      <th>osi_dg</th>
      <th>dsi_dg</th>
      <th>peak_dff_dg</th>
      <th>ptest_dg</th>
      <th>p_run_dg</th>
      <th>run_modulation_dg</th>
      <th>cv_os_dg</th>
      <th>cv_ds_dg</th>
      <th>tf_index_dg</th>
      <th>cell_specimen_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5</td>
      <td>1</td>
      <td>0.280185</td>
      <td>1.23717</td>
      <td>0.0312253</td>
      <td>16.5138</td>
      <td>9.74126e-28</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.938693</td>
      <td>0.0474909</td>
      <td>0.434779</td>
      <td>662201985</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3</td>
      <td>1</td>
      <td>0.0855848</td>
      <td>0.812747</td>
      <td>0.565631</td>
      <td>11.4741</td>
      <td>3.50072e-14</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.614402</td>
      <td>0.42813</td>
      <td>0.39683</td>
      <td>662201975</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>1</td>
      <td>0.140565</td>
      <td>0.439415</td>
      <td>0.801277</td>
      <td>9.85304</td>
      <td>9.07543e-07</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.15991</td>
      <td>0.460012</td>
      <td>0.36523</td>
      <td>662202121</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>3</td>
      <td>0.0109138</td>
      <td>0.557367</td>
      <td>2.97525</td>
      <td>1.33345</td>
      <td>0.00575501</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.146026</td>
      <td>0.438625</td>
      <td>0.178085</td>
      <td>662202077</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>3</td>
      <td>0.099905</td>
      <td>1.37391</td>
      <td>0.882893</td>
      <td>13.2219</td>
      <td>0.000227121</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.808828</td>
      <td>0.652798</td>
      <td>0.324958</td>
      <td>662202612</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Next, we’ll select a cell from our table by <code class="docutils literal notranslate"><span class="pre">cell_specimen_id</span></code>.</p>
<p>If there is a specific cell you want to analyze, you can use the <code class="docutils literal notranslate"><span class="pre">get_cell_specimen_indices()</span></code> method to locate the index of your cell of interest. The index of your cell is needed becasue you will need to index into the NumPy arrary returned by the <code class="docutils literal notranslate"><span class="pre">response</span></code> attribute to contruct your heatmap.</p>
<p>Below, we’ll simply grab the first <code class="docutils literal notranslate"><span class="pre">cell_specimen_id</span></code> in our table.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select specimen ID from first row</span>
<span class="n">specimen_id</span> <span class="o">=</span> <span class="n">dg_df</span><span class="p">[</span><span class="s1">&#39;cell_specimen_id&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">cell_loc</span> <span class="o">=</span> <span class="n">data_dg</span><span class="o">.</span><span class="n">get_cell_specimen_indices</span><span class="p">([</span><span class="n">specimen_id</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Specimen ID:&#39;</span><span class="p">,</span> <span class="n">specimen_id</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cell loc:&#39;</span><span class="p">,</span> <span class="n">cell_loc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Specimen ID: 662201985
Cell loc: 0
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">response</span></code> attribute returns a 4-D NumPy array with the mean responses to each stimulus condition. The 1st column in the returned NumPy array contains mean responses to the orientations, the 2nd column contains mean responses to the temporal frequencies, the 3rd column contains the number of the cell, and the 4th column contains the response mean to column 1, the response standard error of the mean of column 2, and the number of signficant trials.</p>
<p>Below, we’ll use <code class="docutils literal notranslate"><span class="pre">plt.imshow()</span></code> to plot the mean responses across orientation and frequency, skipping the blank sweep column (0).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot our data, skiping the blank sweep column (0) of the temporal frequency dimension</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">dg</span><span class="o">.</span><span class="n">response</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:,</span><span class="n">cell_loc</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;hot&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Heat Map, Cell Specimen: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">specimen_id</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">dg</span><span class="o">.</span><span class="n">tfvals</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">dg</span><span class="o">.</span><span class="n">orivals</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Temporal frequency (Hz)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Direction (deg)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;$\Delta$F/F (%)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/Analyzing_Two_Photon_Data_23_0.png" src="../_images/Analyzing_Two_Photon_Data_23_0.png" />
</div>
</div>
<p>The preferred directions temporal frequency are stored within <code class="docutils literal notranslate"><span class="pre">ori_dg</span></code> and <code class="docutils literal notranslate"><span class="pre">tf_dg</span></code> in are table above and can be indexed through <code class="docutils literal notranslate"><span class="pre">dg.orivals</span></code> and <code class="docutils literal notranslate"><span class="pre">tf.tfvals</span></code> respectively.</p>
<p>For more explanation on the available pre-computed metrics, please see <a href = 'https://alleninstitute.github.io/AllenSDK/_static/examples/nb/brain_observatory_analysis.html#Drifting-Gratings'> here</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pref_ori</span> <span class="o">=</span> <span class="n">dg</span><span class="o">.</span><span class="n">orivals</span><span class="p">[</span><span class="n">dg</span><span class="o">.</span><span class="n">peak</span><span class="o">.</span><span class="n">ori_dg</span><span class="p">[</span><span class="n">cell_loc</span><span class="p">]]</span>
<span class="n">pref_tf</span> <span class="o">=</span> <span class="n">dg</span><span class="o">.</span><span class="n">tfvals</span><span class="p">[</span><span class="n">dg</span><span class="o">.</span><span class="n">peak</span><span class="o">.</span><span class="n">tf_dg</span><span class="p">[</span><span class="n">cell_loc</span><span class="p">]]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Preferred direction:&quot;</span><span class="p">,</span> <span class="n">pref_ori</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Preferred temporal frequency:&quot;</span><span class="p">,</span> <span class="n">pref_tf</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Preferred direction: 225
Preferred temporal frequency: 1
</pre></div>
</div>
</div>
</div>
<p>It is important to not that these are no the only possible analyses that can be done. We could go a step further and also look at the static gratings. We could plot the running speed of the mouse versus the DF/F of our cells to determine what stimlus elicited the fasted response from our mice. We can even use the data to determine the on and off receptive fields all our cells. In the analyses that we performed above we only looked at one experiment container that included one brain area and one cre line, but we are not limited to this and can compare brain areas and cre lines and can begin forming connections between differnt brain regions.</p>
<p>In conclusion, there are many different analyses that you can perform with the two photon imaging data. It is important to look through the downloaded data to ensure your desired brain regions, cre lines, and computed metrics are all availabed before beginning your work.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "nwb4edu/nwb4edu.github.io",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./Chapter_07"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="Retrieving_Brain_Observatory_Data.html" title="previous page">Retrieving Calcium Imaging Data</a>
    <a class='right-next' id="next-link" href="Correlations_in_Two_Photon_Data.html" title="next page">Correlations in Two Photon Data</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Ashley Juavinett & Victor Magdaleno-Garcia<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>